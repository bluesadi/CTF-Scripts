#include <cstdio>
#include <windows.h>
#define BYTE unsigned char

BYTE shellcode[500] = {
    0x55,0x48,0x89,0xE5,0x48,0x83,0xEC,0x10,0x48,0x89,0x4D,0x10,0xC7,0x45,0xFC,0x00,
    0x00,0x00,0x00,0xEB,0x26,0x8B,0x45,0xFC,0x48,0x63,0xD0,0x48,0x8B,0x45,0x10,0x48,
    0x01,0xD0,0x8B,0x55,0xFC,0x48,0x63,0xCA,0x48,0x8B,0x55,0x10,0x48,0x01,0xCA,0x0F,
    0xB6,0x12,0x83,0xF2,0x1E,0x88,0x10,0x83,0x45,0xFC,0x01,0x8B,0x45,0xFC,0x48,0x63,
    0xD0,0x48,0x8B,0x45,0x10,0x48,0x01,0xD0,0x0F,0xB6,0x00,0x84,0xC0,0x75,0xC6,0x48,
    0x83,0xC4,0x10,0x5D,0xC3
};

void encrypt(char *str){
    for(int i = 0;str[i];i ++) str[i] ^= 0x1E;
}

int init(){
	PBYTE addr = (BYTE*)shellcode;
	DWORD old;
	VirtualProtect(addr, 20, PAGE_EXECUTE_READWRITE, &old);
	return 1;
}

int doit = init();

int main(){
    char dest[100] = "flag{this_is_flag}";
    ((void(*)(char *str))shellcode)(dest);
    printf(dest);
}