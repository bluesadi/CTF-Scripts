import os

pyfile = open('D:/CTF/CTF-Scripts/WP/第十三届全国大学生信息安全竞赛/z3-solve.py','w+')

content = 'from z3 import *\n\n'

for i in range(46,88):
    content += f'v{i} = Real(\'v{i}\')\n'

content += 's = Solver()\n'

left =  [
    '0x22 * v49 + 0xC * v46 + 0x35 * v47 + 6 * v48 + 0x3A * v50 + 0x24 * v51 + v52'
    ,'0x1B * v50 + 0x49 * v49 + 0xC * v48 + 0x53 * v46 + 0x55 * v47 + 0x60 * v51 + 0x34 * v52'
    ,'0x18 * v48 + 0x4E * v46 + 0x35 * v47 + 0x24 * v49 + 0x56 * v50 + 0x19 * v51 + 0x2E * v52'
    ,'0x4E * v47 + 0x27 * v46 + 0x34 * v48 + 9 * v49 + 0x3E * v50 + 0x25 * v51 + 0x54 * v52'
    ,'0x30 * v50 + 0xE * v48 + 0x17 * v46 + 6 * v47 + 0x4A * v49 + 0xC * v51 + 0x53 * v52'
    ,'0xF * v51 + 0x30 * v50 + 0x5C * v48 + 0x55 * v47 + 0x1B * v46 + 0x2A * v49 + 0x48 * v52'
    ,'0x1A * v51 + 0x43 * v49 + 6 * v47 + 4 * v46 + 3 * v48 + 0x44 * v52'
    ,'0x22 * v56 + 0xC * v53 + 0x35 * v54 + 6 * v55 + 0x3A * v57 + 0x24 * v58 + v59'
    ,'0x1B * v57 + 0x49 * v56 + 0xC * v55 + 0x53 * v53 + 0x55 * v54 + 0x60 * v58 + 0x34 * v59'
    ,'0x18 * v55 + 0x4E * v53 + 0x35 * v54 + 0x24 * v56 + 0x56 * v57 + 0x19 * v58 + 0x2E * v59'
    ,'0x4E * v54 + 0x27 * v53 + 0x34 * v55 + 9 * v56 + 0x3E * v57 + 0x25 * v58 + 0x54 * v59'
    ,'0x30 * v57 + 0xE * v55 + 0x17 * v53 + 6 * v54 + 0x4A * v56 + 0xC * v58 + 0x53 * v59'
    ,'0xF * v58 + 0x30 * v57 + 0x5C * v55 + 0x55 * v54 + 0x1B * v53 + 0x2A * v56 + 0x48 * v59'
    ,'0x1A * v58 + 0x43 * v56 + 6 * v54 + 4 * v53 + 3 * v55 + 0x44 * v59'
    ,'0x22 * v63 + 0xC * v60 + 0x35 * v61 + 6 * v62 + 0x3A * v64 + 0x24 * v65 + v66'
    ,'0x1B * v64 + 0x49 * v63 + 0xC * v62 + 0x53 * v60 + 0x55 * v61 + 0x60 * v65 + 0x34 * v66'
    ,'0x18 * v62 + 0x4E * v60 + 0x35 * v61 + 0x24 * v63 + 0x56 * v64 + 0x19 * v65 + 0x2E * v66'
    ,'0x4E * v61 + 0x27 * v60 + 0x34 * v62 + 9 * v63 + 0x3E * v64 + 0x25 * v65 + 0x54 * v66'
    ,'0x30 * v64 + 0xE * v62 + 0x17 * v60 + 6 * v61 + 0x4A * v63 + 0xC * v65 + 0x53 * v66'
    ,'0xF * v65 + 0x30 * v64 + 0x5C * v62 + 0x55 * v61 + 0x1B * v60 + 0x2A * v63 + 0x48 * v66'
    ,'0x1A * v65 + 0x43 * v63 + 6 * v61 + 4 * v60 + 3 * v62 + 0x44 * v66'
    ,'0x22 * v70 + 0xC * v67 + 0x35 * v68 + 6 * v69 + 0x3A * v71 + 0x24 * v72 + v73'
    ,'0x1B * v71 + 0x49 * v70 + 0xC * v69 + 0x53 * v67 + 0x55 * v68 + 0x60 * v72 + 0x34 * v73'
    ,'0x18 * v69 + 0x4E * v67 + 0x35 * v68 + 0x24 * v70 + 0x56 * v71 + 0x19 * v72 + 0x2E * v73'
    ,'0x4E * v68 + 0x27 * v67 + 0x34 * v69 + 9 * v70 + 0x3E * v71 + 0x25 * v72 + 0x54 * v73'
    ,'0x30 * v71 + 0xE * v69 + 0x17 * v67 + 6 * v68 + 0x4A * v70 + 0xC * v72 + 0x53 * v73'
    ,'0xF * v72 + 0x30 * v71 + 0x5C * v69 + 0x55 * v68 + 0x1B * v67 + 0x2A * v70 + 0x48 * v73'
    ,'0x1A * v72 + 0x43 * v70 + 6 * v68 + 4 * v67 + 3 * v69 + 0x44 * v73'
    ,'0x22 * v77 + 0xC * v74 + 0x35 * v75 + 6 * v76 + 0x3A * v78 + 0x24 * v79 + v80'
    ,'0x1B * v78 + 0x49 * v77 + 0xC * v76 + 0x53 * v74 + 0x55 * v75 + 0x60 * v79 + 0x34 * v80'
    ,'0x18 * v76 + 0x4E * v74 + 0x35 * v75 + 0x24 * v77 + 0x56 * v78 + 0x19 * v79 + 0x2E * v80'
    ,'0x4E * v75 + 0x27 * v74 + 0x34 * v76 + 9 * v77 + 0x3E * v78 + 0x25 * v79 + 0x54 * v80'
    ,'0x30 * v78 + 0xE * v76 + 0x17 * v74 + 6 * v75 + 0x4A * v77 + 0xC * v79 + 0x53 * v80'
    ,'0xF * v79 + 0x30 * v78 + 0x5C * v76 + 0x55 * v75 + 0x1B * v74 + 0x2A * v77 + 0x48 * v80'
    ,'0x1A * v79 + 0x43 * v77 + 6 * v75 + 4 * v74 + 3 * v76 + 0x44 * v80'
    ,'0x22 * v84 + 0xC * v81 + 0x35 * v82 + 6 * v83 + 0x3A * v85 + 0x24 * v86 + v87'
    ,'0x1B * v85 + 0x49 * v84 + 0xC * v83 + 0x53 * v81 + 0x55 * v82 + 0x60 * v86 + 0x34 * v87'
    ,'0x18 * v83 + 0x4E * v81 + 0x35 * v82 + 0x24 * v84 + 0x56 * v85 + 0x19 * v86 + 0x2E * v87'
    ,'0x4E * v82 + 0x27 * v81 + 0x34 * v83 + 9 * v84 + 0x3E * v85 + 0x25 * v86 + 0x54 * v87'
    ,'0x30 * v85 + 0xE * v83 + 0x17 * v81 + 6 * v82 + 0x4A * v84 + 0xC * v86 + 0x53 * v87'
    ,'0xF * v86 + 0x30 * v85 + 0x5C * v83 + 0x55 * v82 + 0x1B * v81 + 0x2A * v84 + 0x48 * v87'
    ,'0x1A * v86 + 0x43 * v84 + 6 * v82 + 4 * v81 + 3 * v83 + 0x44 * v87'
]

right = [
    0x00004F17,0x00009CF6,0x00008DDB,0x00008EA6,0x00006929,0x00009911,0x000040A2,0x00002F3E,
    0x000062B6,0x00004B82,0x0000486C,0x00004002,0x000052D7,0x00002DEF,0x000028DC,0x0000640D,
    0x0000528F,0x0000613B,0x00004781,0x00006B17,0x00003237,0x00002A93,0x0000615F,0x000050BE,
    0x0000598E,0x00004656,0x00005B31,0x0000313A,0x00003010,0x000067FE,0x00004D5F,0x000058DB,
    0x00003799,0x000060A0,0x00002750,0x00003759,0x00008953,0x00007122,0x000081F9,0x00005524,
    0x00008971,0x00003A1D
]

for i in range(42):
    content += f's.add({left[i]} == {right[i]})\n'

content += f's.add('

for i in range(46,88):
    content += f'v{i} < 127,v{i} > 32'
    if i != 87:
        content += ','

content += ')\n'

content += 's.check()\nresult = s.model()\nflag = \'\'\nfor i in range(46,88):\n\tflag += chr(result[Real(f\'v{i}\')].as_long())\nprint(flag)'


pyfile.write(content)